import { Story, Preview, Meta, Props } from '@storybook/addon-docs/blocks';

<Meta title="框架|起步（Step）/目录结构" />

## 工程化

`vsee`框架秉承工程化的理念，结合服务端技术所拥有的层级，对项目进行了结构化的划分。大部分的项目结构都是通过自动化导入实现的，因此对于开发人员来说可以达到**最少认知原则**。`vsee`的结构分层次分为**平台**、**组件**、**项目**、**模块**。

## 平台

`vsee`是构建在`vue-cli`基础上的，并对整个项目进行了一个简单的分层，你可以很容易分别他们：

```sh
- vsee          // 框架的根目录
  - .storybook  // storybook的配置目录
  - components  // 项目的组件包
  - config      // vue-cli的相关配置包
  - lib         // 项目的插件库
  - projects    // 项目集
  - public      // 静态资源包
  - stoires     // 故事书目录
  - test        // 测试目录
  ...           // 其他 配置文件
```

在这个框架中，大部分的配置文件和`vue-cli`是极其相似的，只是目录的分解不一样而已。但`vsee`仍然集成了很多有用的环境，这里不仅可以开发多套项目，同时可以将自己构建项目的过程、心得、组件等书写成故事书，让你在一个平台中的多个项目共享一个生态环境，同时发布一个可以让大家直观可见的组件库和知识库。

## 组件

在我们的框架根目录有两个对于项目来说非常有用的包：`components`和`lib`，两个都是项目中所需要的扩展，一个基于UI，一个基于数据。`components`大体上和其他的UI框架相似，但更高级的是，有一些组件是带有业务特性，或者具备定制性的组件。例如下拉列表，对于开发者来说，无论哪个UI库，其配置和操作的方式都过于复杂，并且代码不一定集中。封装一个只基于`url`来获取数据源的下拉列表，就能让很多开发者只配置一个`url`地址行。

`lib`包的用处更多，其内部包含了：

```sh
- directives  // @dir 指令集
- http        // @http 网络请求中心
- i18n        // @i18n 国际化中心
- mixins      // @mix 混入器
- router      // @router 路由
- store       // @store 数据中心
- utils       // @util 工具包
```

`vsee`的组件用到了很多别名，上面所提到`@*`的就是他们的别名，你可以在项目中的任意处去引用他们，就像这样：

```js
import('@dir/v-focus.js');    // 为项目加载`v-focus`指令
import http from '@http';     // 加载网络请求中心
import formRecordMix from '@mix/form-record.js';  // 加载表单记录器
import { getUUID } from '@util/datahelper.js'; // 加载数据助理中的一个函数
// ...
```

后续会有更多的文档分享如何去使用他们。

## 项目

在`vsee`的根目录下，有一个`projects`文件夹，这里堆放的就是一个个独立的项目了。每个项目都是按照模块化的方式组成，后面会提到这块。对于开发者来说，更加应该关注的是`projects`以及里面的模块，顶层文件夹和文件都是由技术经理或者架构师负责整体把控的。每个初始化的项目都会有如下几个文件和文件夹：

```sh
- *               // 业务模块
- common          // 别名`~~`，主要是存放公共业务信息的地方，存放规则可自行协商
- layout          // 布局模块，是整个项目最外层的主体
- result          // 异常内容模块，主要显示`404`、`405`和`500`的地方，可根据情况自行添加
- bootstrap.js    // 项目的前置引导文件，优先于`main.js`文件加载
- config.js       // 项目的配置文件
- main.js         // 项目的主入口
- theme.js        // 项目的主题配置文件
```

上面的星号*****表示的是自定义的业务模块，和其他模块不同的是，这个业务模块是按照三层结构的方式搭建，后面讲模块的时候会提到。业务模块，也是开发人员的核心焦点，对于其他模块，在项目初期完善后，就基本可以定型不用打理了。

## 模块

上面提到的业务模块，就是放在这里讲解的。由于前端一直以来不像后端`Java`、`.NET`等那样完全面向对象以及具有很严格的语法特性，因此前端开发中模式一直以来也很混乱。虽然也有`MVC`这样的理论作为支撑，但是仍然在开发过程中代码一片狼藉。按照后段服务治理的一些思路，在业务模块构建的时候，定义这样的六三层结构，分别是：

- 视图层： router、view、locale；
- 数据层： store；
- 链路层： api、mock

路由`router`其实只是视图`view`的一种包装，主要负责公开视图到浏览器上，方便用户进行导航。从形式上，他们都是`*.vue`文件。但我们不建议在`router`中写过重的页面，你应该把子页面都放在`view`中，后面所称呼的视图将都指代`router`和`view`。`locale`是用于国际化的，是嵌入在`router`和`view`里的。`vsee`已经将这三块做了自动化处理，因此只要按照规范的结构来书写，可以不用做任何配置，自动化实现路由的拼接和国际化的注入。

但由于视图可能被拆分的很细，因此组件之间进行数据共享将变得非常麻烦。虽然组件通信不是一件难事，但我们并不建议使用`EventBus`来驱动，而是使用`store`。这时的数据层`store`就凸显作用了。`store`是基于当前业务模块的，也是被自动化导入的，每一个视图应该去通过当前模块的`store`去做数据的转存。`store`的结构和`vuex`中提到的`modules`结构完全一致，自动化导入，无需担心多人开发时出现污染的情况。而且，我们统一为每个模块额外添加了很多有用的方法，方便各位开发者对数据的处理，`store`只需要调用对应模块的`api`即可。

对于一个大项目，当请求接口变多时，有时会很难维护。而且拆解项目时，接口和视图的耦合过高，也会导致有一些额外的处理。`api`主要负责定义项目中所使用的接口，同样也是按照模块的方式划分，这样有助于开发者维护，但前提是模块的边界一定是相当清晰，且和其他模块尽可能少的关联。`mock`负责对`api`发起的请求进行拦截，主要用于数据模拟，尤其在本地开发模式和发布演示模式下非常有用。本地开发模式是指前端开发优先于服务端开发，因此没有数据时的临时处理方案，发布演示模式是可以提前发布一个简单的动态原型给参与人员进行演练。由于模拟数据在联调完数据之后，基本上不会有太大改动，因此前置的开发任务一定需要服务端将接口和接口数据定义好，这样才能避免联调之后的反工现象。

总结一下，视图层负责组装国际化内容到视图中，并提炼出路由给用户予以访问；视图层向数据层发起数据请求，由模块化的`store`代理向链路层发起网络请求，请求的数据可以直接缓存到`store`中；`api`负责发起请求，共给上层所对应的数据，`mock`负责模拟数据，用于本地开发模式或发布演示模式。其文件结构如下：

```
- user                // 一个用户管理的模块
  - locales           // 国际化
    - en.json         // 英文国际化
    - zh.json         // 中文国际化
  - mock              // 模拟服务
    - index.js        // 数据模拟
  - router            // 路由
    - index.vue       // 将发布为`/user`的路由
  - store             // 数据层
    - index.js        // store结构体
  - view              // 视图
    - user-form.vue   // 用户表单
    - user-table.vue  // 用户表格
  - api.js            // 接口目录
- order               // 一个订单管理的模块
  - locales           // 国际化
    - en.json         // 英文国际化
    - zh.json         // 中文国际化
  - mock              // 模拟服务
    - index.js        // 数据模拟
  - router            // 路由
    - list.vue        // 将发布为`/order/list`的路由
    - order-line.vue  // 将发布为`/order/order-line`的路由
    - detail          // 不公开路由
      - detail.id.vue // 将发布为`/order/detail/:id`的路由
  - store             // 数据层
    - index.js        // store结构体
  - view              // 视图
    - user-form.vue   // 用户表单
    - user-table.vue  // 用户表格
  - api.js            // 接口目录
```

当熟悉了这三层结构六个子模块，也就掌握了整个`vsee`的核心。有关每个核心的功能以及如何编码，将会在框架`core`中详细介绍其功能和写法。现在只是稍作了解，并且有如下几点要注意：

1. 不是要求所有的业务模块都一定要包含这六个子模块，如果你没有国际化，可以省略这个文件夹；如果你没有接口请求，也可以省略；如果你不需要模拟或者`store`这些都可以省略。六个子模块只是一个完整情况。
2. 该省略的模块还是省略，这样可以减少程序加载时所带来的不必要检测，因为这些子模块都是由程序自动化加载配对的。
3. 你应该合理的设计这六个子模块的内容，并降低业务模块之间的耦合。如果仍然有一些是共性的，或者需要提炼出来的，可以放在`common`公共模块中，但`common`尽可能只放一些数据模型或者通用业务数据处理的函数。







