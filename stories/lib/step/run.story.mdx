import { Story, Preview, Meta, Props } from '@storybook/addon-docs/blocks';

<Meta title="框架/起步（Step）/启动" />

## 开发

`vsee`框架可以基于一个生态下同时开发多个项目，因此，启动项目的方式相比同类型框架的`npm run dev`要多出一些参数，下面一一举例：

```base
# 以本地模拟的方式启动名为`orm`的项目
npm run dev --project=orm

# 以本地联调的方式启动名为`oa`的项目
npm run dev --project=oa --test
```

- 参数`project`指定项目的名称，只有满足特定项目结构的项目才能被正常启动，启动时也会检测很多必要的配置选项。
- 参数`test`指定是否为**联调模式**，`vsee`中开发有两种模式。一种是本地开发模式，本地开发模式下会默认启动`mock`模块，因此你可以通过已经加载好的自动化`mock`进行数据模拟；另一种是本地联调模式，该模式下会通过网络代理向后台服务器发出请求，因此你可以和后端进行测试。

## 打包

`vsee`为打包命令也提供了很多参数，其中`project`参数同开发模式，另外还附加了一下参数：

```base
# 不压缩代码模式打包名为`orm`的项目
npm run build:sit --project=orm --unzip
# 启用服务器压缩打包名为`orm`的项目
npm run build:uat --project=orm --gzip
# 启动打包可视化
npm run build:sit --project=orm --report
# 将打包结果上传服务器
npm run build:sit --project=orm --ftp
# 启用模拟数据
npm run build:sit --project=orm --test
```

- 参数`unzip`可以在发布测试环境下不压缩代码（默认的**build**都是会压缩代码的），这样可以在线上环境进行调试，但建议使用在`sit`和`uat`环境下，不建议在`prod`上启用，除非你知道可以这么做。
- 参数`gzip`可以开启服务器`gzip`压缩算法，减少文件大小，降低服务器负载。要正确并且成功使用此项，需要联系相关部署人员，否则你的项目有可能跑不起来。
- 参数`report`启用后，会在打包完成之后生成一个页面，通过数据可视化的方式来查看你打包的结构和打包内部构造，以观察有哪些代码包是可以进行优化的。
- 参数`ftp`开启后，打包完成时，会将**dist**目录下的项目复制到**ftp服务器**上。但由于所使用的钩子函数没有在上传完成后关闭程序，因此只能手动关闭。
- 参数`test`开启后，打包完成时，会将数据模拟服务也打包上去，在线上环境可以直接演示模拟数据，可以不连接服务端进行离线应用检测，在演示开发的时候非常有用。

> 注意，`test`参数我们在命令中配置了两次，`dev`和`build`都是可以使用`test`参数，其作用就是判断是否连接代理服务，但方式完全不一样。`dev`下默认是模拟数据，启用`test`后连接代理，`build`下默认是启用代理，启用`test`则是打包模拟数据上线。

上面的打包命令中，使用了`build:sit`、`build:uat`，这是提前配置好的模式：

- **:sit** - 开发模式，测试人员进行线上测试的环境；
- **:uat** - 用户测试模式，用户进行线上测试的环境；
- **:prod** - 生产环境，用户进行线上生产的环境；

注意，不同环境所使用的环境变量以及连接的后端服务地址都不一样，因此需要和相关人员配合，配置确认后，按需打包发送线上。如果不配置环境，则默认是本地打包环境。

## 环境配置

在项目的根目录下，分别有如下可见文件，形如`.env.*`：

```sh
// 开发配置（即运行`npm run dev ...`时读取的配置文件）
.env.development
// 本地测试配置（即运行`npm run build ...`时读取的配置文件）
env.production
// 生产配置（即运行`npm run build:prod ...`时读取的配置文件）
env.production.prod
// 用户测试配置（即运行`npm run build:uat ...`时读取的配置文件）
env.production.uat
// 开发测试配置（即运行`npm run build:sit ...`时读取的配置文件）
env.production.sit
```

