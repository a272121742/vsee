import { Story, Preview, Meta, Props } from '@storybook/addon-docs/blocks';

<Meta title="框架|核心（Core）/样式（style）" />

# 样式

`vsee`使用的是`less`作为`precss`技术，结合`ant-design-vue`可以很方便、直接了当的开发出好看的界面样式。在平台中，内置了三种样式：

1. `ant-design-vue.less`组件样式
2. `theme.less`全局样式
3. `*.vue scoped less`视图样式

这三种样式是至上而下进行加载的。

## Global Less

系统内置了全局样式定义，名称为`theme.less`，被放置在项目的根目录下，以`aqs`项目为例：

```sh
- aqs
  - order           // 订单业务模块
  - layout          // 布局模块
  - bootstra.js     // 前置引导模块
  - main.js         // 主入口
  - config.js       // 应用配置
  - theme.less      // 全局样式文件
```

`theme.less`是一个四层结构，分别是：

1. 规范定义；
2. 组件库注入（Ant Design Vue）；
3. 系统框架注入（Vsee）；
4. 自定义；

一个`theme.less`的案例如下：

```less
/** 规范定义 **/
// 主字体集合
@global-font-family: 'SYHT', 'roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
// 第一字体
@global-font-face-t1: 'SYHT';
// 第二字体
@global-font-face-t2: 'roboto';
// 正常字体大小
@global-font-size-normal: 14px;
// 标题字体大小
@global-font-size-title: 20px;
// 说明字体大小（用于一些较小字体场景）
@global-font-size-desc: 12px;
// 标识字体大小（用于一些较大字体场景）
@global-font-size-banner: 28px;
// 常规字重
@global-font-weight-normal: 400;
// 中文加粗字重
@global-font-weight-bold-zh: 500;
// 英文加粗字重
@global-font-weight-bold-en: 600;
// 文字行高
@global-font-line-height: 1;

// 品牌色
@global-brand-color: #0097E0;
// 【主题色】全局背景色
@global-theme-bg-color: #FFFFFF;
// 【主题色】页面背景色
@page-theme-gb-color: #F5F5F5;
// 【主题色】板块背景色
@block-theme-gb-color-normal: transparent;
// 【主题色】透明板块背景色
@block-theme-gb-color-transparent: transparent;
// 【主题色】主字色
@global-font-color: #595959;
// 【主题色】辅字色1
@global-font-color-1: #262626;
// 【主题色】辅字色2
@global-font-color-2: #8C8C8C;
// 【功能色】通行色
@global-success-color: #32B700;
// 【功能色】否定色
@global-error-color: #D1291A;
// 【功能色】警告色
@global-warning-color: #FABE00;
// 【功能色】失效色
@global-disabled-color: #BFBFBF;
// 【功能色】阴影色
@global-shadow-color: rgba(0, 0, 0, .12);
// 【功能色】边框色
@global-border-color: #D9D9D9;
// 【层次】应用层
@global-layer-app: 0;
// 【层次】内容展示层
@global-layer-content: 1;
// 【层次】下拉展示层
@global-layer-overlay: 1000;
// 【层次】导航层
@global-layer-nav: 1050;
// 【层次】辅助层
@global-layer-helper: 1100;
// 【层次】模态层
@global-layer-modal: 1200;
// 【层次】通知层
@global-layer-notify: 1500;
// 【层次】封顶层
@global-layer-max: 2000;
// 【阴影】横向1级
@global-shadow-h1: 0 2px 4px 0 @global-shadow-color;
// 【阴影】横向2级
@global-shadow-h2: none;
// 【阴影】纵向1级
@global-shadow-v1: 2px 2px 4px 0 @global-shadow-color;
// 【阴影】纵向2级
@global-shadow-v2: none;
// 【阴影】环绕1级
@global-shadow-b1: 0 2px 8px @global-shadow-color;
// 【阴影】环绕2级
@global-shadow-b2: none;
// 小间距
@global-gap-small: 8px;
// 普通间距
@global-gap-normal: 16px;
// 大间距
@global-gap-large: 24px;

// ant-design-vue 配置 https://github.com/vueComponent/ant-design-vue/blob/master/components/style/themes/default.less
@font-family: @global-font-family;
@primary-color: @global-brand-color; // 全局主色
@link-color: @global-brand-color; // 链接色
@success-color: @global-success-color; // 成功色
@warning-color: @global-warning-color; // 警告色
@error-color: @global-error-color; // 错误色
@body-background: @global-theme-bg-color; // body背景色
@heading-color: @global-font-color-1; // 标题色
@text-color: @global-font-color; // 主文本色
@border-color-base: @global-border-color; // 边框色
@text-color-secondary: @global-font-color-2; // 次文本色
@disabled-color: @global-disabled-color; // 失效色
@box-shadow-base: @global-shadow-b1; // 浮层阴影

// vsee 配置
@app-layout-header-height: 64px;  // 应用布局头部高度
@app-layout-footer-height: 0px;   // 应用布局底部高度
@app-content-header-height: 48px; // 内容区域头部高度
@app-content-footer-height: 0px;  // 内容区域底部高度
@app-content-border-width: 16px;  // 内容区域外边距
@app-content-sider-width: 200px;  // 内容菜单宽度
@app-content-sider-width-min: 80px; // 内容菜单最小宽度
@app-content-sider-trigger-height: 48px;  // 内容菜单控制器高度
@app-content-padding: 12px 16px;  // 内容区域内边距
@app-layout-zindex: @global-layer-nav;
@app-content-zindex: @global-layer-content;
@app-theme-color: @global-theme-bg-color;  //主题色
@app-background-color: @page-theme-gb-color;  // 背景底色
@app-content-background-color: @global-theme-bg-color;
@box-shadow-h: @global-shadow-h1;
@box-shadow-v: @global-shadow-v1;

/**
 * 1. 请使用如下方式增加颜色的定义
 * @your-defined: color(~`colorPalette('@{other-defined}', 1)`);
 * 例如，定义线条颜色，取全局边框色`@global-border-color`进行运算后取第3个值，取值范围 1~10。
 * @line-color: color(~`colorPalette('@{global-border-color', 3)`);
 * 2. 或者使用`fade`函数设置透明度来改变颜色
 * 例如，定义同类元素背景的颜色，进行透明度`4%`的的设置
 * @panel-border-color: red;
 * @panel-gb-color: fade(@panel-border-color, 4%);
 */

// 这里是其他样式的定义
```

对该文件需要有几点说明：

1. `theme.less`不是必须的，你甚至可以自己定义一个`global.less`放置在`common`文件夹中，然后在`bootstrap.js`或`main.js`文件中引入。但这样需要开发者自行引入，并且这样引入的文件不具备定义全局变量的特性；
2. `theme.less`案例中不难发现，上半部分可以定义`less常量`，下半部分可以修改`ant-design-vue`的嵌套样式。这也是我们为什么采用这种方式而不建议开发者自己引入的原因，`theme.less`中可以像正常`less`一样为其他组件提供全局的`less常量`；
3. `theme.less`的常量定义是处于`append`状态的，如上面提到的加载顺序，优先加载`ant-design-vue.less`，再加载`theme.less`，最后加载`vue scoped less`，因此`theme.less`除了给后面的`vue scoped less`提供常量支持，还可以覆盖`ant-design-vue.less`所定义的样式，做到主题可定制；
4. `theme.less`无`scoped`范围，是全局的，因此开发过程中需要谨慎使用。这就需要开发者有系统性的开发技巧，能对整体样式进行宏观把控；
5. `theme.less`是可拔插的，你甚至可以删除掉这个文件，也不会对程序产生错误。除非你在`*.vue`文件中引入了里面的变量，会因为变量未定义而报错。

> 注意：过去我们是定义的`theme.js`文件（现在废除这种写法），这个文件维护起来非常不友好，即没有实时性（修改之后要重新运行项目），也缺乏灵活性（只能以`key-value`形式定义变量）。所以我们对这种方式进行了改进，让开发者进行全局样式的制定。

## 补丁less

除了设置一些环境配置，我们还经过一些项目的通用性整理，增加了一些额外的样式库，这些样式库可以在下面的子组件、子页面中直接使用：

```less
// 通过配置`col-layout-form`，改变`ant-design-vue`的布局方式，使其更加紧凑
@form-label-fixed-width: 88px;
.col-layout-form.ant-form-horizontal, 
.col-layout-form.ant-form-inline {
  .ant-form-item {
    display: flex;
    margin-bottom: 2px;
    .ant-form-item-label {
      flex: none;
      flex-basis: @form-label-fixed-width;
      label {
        display: inline-block;
        width: @form-label-fixed-width;
        max-height: 28px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: initial;
        word-break: break-all;
        line-height: 1;
        margin-top: 5px;
      }
    }
    .ant-form-item-control-wrapper {
      flex: auto;
    }
  }
  .col-layout-form-actions {
    float: right;
    margin: 4px 12px 0;
  }
} 
.col-layout-form.ant-form-vertical {
  .ant-form-item {
    padding-bottom: 2px;
    .ant-form-item-label {
      padding-bottom: 2px;
    }
    // 时间类型组件长度100%
    .ant-calendar-picker, .ant-time-picker {
      display: block;
    }
  }
  .col-layout-form-actions {
    float: right;
    margin: 23px 12px 0;
  }
}
.col-layout-form.col-layout-search-form.ant-form-vertical {
  .ant-form-item {
    margin-bottom: 8px;
    .ant-form-explain {
      margin-top: -4px;
      margin-bottom: -18px;
    }
  }
}

// 设置滚动条样式
::-webkit-scrollbar {
  height: 6px;
  width: 6px;
}
::-webkit-scrollbar-thumb {
  border-radius: 6px;
  background: fade(@primary-color, 66%);
}
::-webkit-scrollbar-thumb:hover {
  cursor: pointer;
  background: @primary-color;
}
::-webkit-scrollbar-track {
  background: rgba(0,0,0,0.04);
}

// 设置表格文本省略
.ant-table-wrapper.ellipsis-table{
  // 设置表格内容不换行
  table {
    // 只有定义表格的算法为fixed,th才有效果
    table-layout: fixed;
    word-wrap:break-all;
  }
  th > div, td {
    // 超出长度的文字隐藏
    overflow: hidden;
    // 文字隐藏以后添加省略号
    text-overflow: ellipsis;
    // 强制不换行
    white-space: nowrap;
    // 文字不换行
    word-break: keep-all;
  }
  // 设置单元格内填充
  .ant-table-thead > tr > th,
  .ant-table-tbody > tr > td {
    padding: 12px;
  }
}
```

> 注：后续我们也会针对一些常见的补丁`less`做专题文档。